name: Generate Provenance

on:
  # push:
  #   branches: [main]
  # pull_request:
  #   branches: [main]
  workflow_dispatch:  # 仅手动触发：Actions 页选择该 workflow 后点 "Run workflow"

jobs:
  generate_provenance:
    permissions:
      actions: read
      id-token: write
      contents: write
    # v1.7.0 内部使用已弃用的 upload-artifact v3，会报错；改用 v2.1.0 已修复
    uses: slsa-framework/slsa-github-generator/.github/workflows/builder_container-based_slsa3.yml@v2.1.0
    with:
      # 使用公开 Maven 镜像，fork 后无需私有 registry 即可运行
      builder-image: "maven"
      builder-digest: "sha256:545933763425d1afde0cb5da093dd14c8bf49c0849ca78d7f4f827894d7b1f1e"
      config-path: "buildconfigs/hello_transparent_release_mvn.toml"
      provenance-name: "hello_transparent_release.intoto"
      compile-builder: true
